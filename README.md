# 労働安全衛生チャットボット

AI搭載のウェブベース顧客サポートチャットボット。労働安全衛生に関する質問に回答し、ナレッジベースを管理できるシステムです。

## 主な機能

- **AI チャット機能**: 3つのAIプロバイダーに対応（Google Gemini、OpenAI ChatGPT、Anthropic Claude）
- **ナレッジベース統合**: 労働安全衛生に関する知識を検索・参照
- **ナレッジ管理**: ウェブインターフェースから新しい知識を追加可能
- **カテゴリー分類**: 法律・規則、労働災害、健康管理、保護具など6つのカテゴリー
- **会話履歴**: コンテキストを保持した連続した対話
- **柔軟なAI選択**: 環境変数で簡単にAIプロバイダーを切り替え可能

## システムプロンプト

本システムでは、以下のシステムプロンプトを使用しています：

```
あなたは顧客サポート向けに設計された、AI 搭載のウェブベース・チャットボットです。
必要に応じて追加の知識モジュールを埋め込める柔軟なアーキテクチャを備えています。
コア機能は、更新可能な内部ナレッジベース（ナレッジ）を活用し、労働安全衛生に関する
典型的な質問に正確かつ明確に答えることです。

指示:
1. 回答の前に、ユーザーの質問を内部で必ずレビューし、意図を特定し、
   労働安全衛生のトピックとの関連性を確認すること。
2. 追加の知識モジュールが存在する場合はそれを参照し、最も網羅的かつ最新の回答を提供すること。
3. 質問が労働安全衛生の領域や現在の埋め込み知識の範囲外にある場合は、
   その旨を丁寧に伝え、関連する質問のみ扱うことを申し出ること。
4. 段階的に考えること：質問の分析 → 必要知識の特定 → 回答の検索・組み立て →
   埋め込み知識との照合 → 返答の整形。
5. 労働安全・衛生に関する妥当な質問には、常に明確かつ簡潔に答える努力を継続すること。

書式:
- 自然で会話的な日本語で回答する。
- 回答は簡潔に（2〜5文）。複雑な質問では必要に応じて箇条書きを用いる。
- 特に一般的または重要な質問の場合は、その旨を明示し、該当する場合は予防的な安全ヒントも提示する。
```

## プロジェクト構造

```
chatbot/
├── public/              # フロントエンド（ブラウザで表示）
│   ├── index.html      # メインHTML
│   ├── style.css       # スタイルシート
│   └── script.js       # クライアント側JavaScript
├── src/                # バックエンド
│   └── server.js       # Express サーバー + API
├── data/               # データ保存
│   └── knowledge.json  # ナレッジベース（JSON形式）
├── package.json        # Node.js 依存関係
├── .env.example        # 環境変数の例
├── .gitignore          # Git除外設定
└── README.md           # このファイル
```

## セットアップ

### 1. 依存関係のインストール

```bash
npm install
```

### 2. 環境変数の設定

`.env.example` をコピーして `.env` ファイルを作成します。

```bash
cp .env.example .env
```

`.env` ファイルを編集して、使用したいAIプロバイダーを選択し、対応するAPIキーを設定します：

#### オプション1: Google AI Studio (Gemini) - おすすめ

```env
AI_PROVIDER=google
GOOGLE_API_KEY=your_google_api_key_here
PORT=3000
```

**Google API キーの取得方法:**
1. https://aistudio.google.com/app/apikey にアクセス
2. Googleアカウントでログイン
3. 「Create API Key」をクリック
4. 無料枠が大きく、高性能なGemini 1.5 Flashが使えます

#### オプション2: OpenAI (ChatGPT)

```env
AI_PROVIDER=openai
OPENAI_API_KEY=your_openai_api_key_here
PORT=3000
```

**OpenAI API キーの取得方法:**
1. https://platform.openai.com/api-keys にアクセス
2. アカウントを作成またはログイン
3. 「Create new secret key」をクリック
4. GPT-4o-miniを使用（コスト効率が良い）

#### オプション3: Anthropic (Claude)

```env
AI_PROVIDER=anthropic
ANTHROPIC_API_KEY=your_anthropic_api_key_here
PORT=3000
```

**Anthropic API キーの取得方法:**
1. https://console.anthropic.com/ にアクセス
2. アカウントを作成またはログイン
3. API Keysセクションから新しいキーを生成
4. Claude 3.5 Sonnetを使用（高品質な応答）

### 3. サーバーの起動

```bash
npm start
```

開発モード（ファイル変更時に自動再起動）：

```bash
npm run dev
```

### 4. ブラウザでアクセス

サーバー起動後、以下のURLにアクセスします：

```
http://localhost:3000
```

## 使い方

### チャット機能

1. メインページの入力欄に質問を入力
2. 送信ボタンをクリック、または Enter キーを押す
3. AIが関連するナレッジベースを参照して回答

**質問例:**
- 労働安全衛生法とは何ですか？
- 事務所で起こりやすい労働災害の例を教えてください
- 熱中症への対策を教えてください
- ストレスチェック制度とは？

### ナレッジの追加

右側パネルの「新しいナレッジを追加」フォームから：

1. カテゴリーを選択
2. 質問を入力
3. 回答を入力
4. キーワードをカンマ区切りで入力
5. 「追加」ボタンをクリック

追加されたナレッジは `data/knowledge.json` に保存され、即座にチャットで利用可能になります。

## ナレッジベースのカテゴリー

1. **法律・規則**: 労働安全衛生法、選任義務など
2. **労働災害**: 事務所・建設現場での災害、対応方法
3. **健康管理**: 定期健康診断、ストレスチェック、熱中症対策
4. **保護具・安全装置**: ヘルメット、安全帯、各種保護具
5. **リスクアセスメント**: 危険性評価、リスク低減措置
6. **安全衛生教育**: 雇入れ時教育、特別教育

## API エンドポイント

### POST `/api/chat`

チャットメッセージを送信し、AI応答を取得

**リクエスト:**
```json
{
  "message": "労働安全衛生法とは何ですか？",
  "conversationHistory": []
}
```

**レスポンス:**
```json
{
  "reply": "労働安全衛生法は...",
  "knowledgeUsed": true,
  "knowledgeCount": 3
}
```

### GET `/api/knowledge`

全ナレッジベースを取得

### POST `/api/knowledge`

新しいナレッジを追加

**リクエスト:**
```json
{
  "categoryId": "laws",
  "question": "安全管理者の選任義務とは？",
  "answer": "常時50人以上の労働者を使用する事業場では...",
  "keywords": ["安全管理者", "選任", "義務"]
}
```

### GET `/api/health`

サーバーとAPI設定の状態確認

## 技術スタック

- **フロントエンド**: HTML5, CSS3, Vanilla JavaScript
- **バックエンド**: Node.js, Express.js
- **AI API**:
  - Google AI Studio (Gemini 1.5 Flash) - デフォルト
  - OpenAI (GPT-4o-mini)
  - Anthropic (Claude 3.5 Sonnet)
- **データ保存**: JSON ファイル（将来的にはデータベース対応可能）

## カスタマイズ

### システムプロンプトの変更

`src/server.js` の `SYSTEM_PROMPT` 定数を編集してください。

### ナレッジベースの編集

`data/knowledge.json` を直接編集するか、ウェブインターフェースから追加できます。

### スタイルの変更

`public/style.css` の CSS 変数（`:root`セクション）を編集することで、
カラースキームを簡単に変更できます。

```css
:root {
    --primary-color: #2563eb;  /* メインカラー */
    --secondary-color: #10b981; /* アクセントカラー */
    /* ... */
}
```

## トラブルシューティング

### APIキーが設定されていないエラー

`.env` ファイルが存在し、正しい API キーが設定されているか確認してください。

### ポートが使用中エラー

`.env` ファイルで別のポート番号を指定してください：

```env
PORT=3001
```

### ナレッジベースが読み込まれない

`data/knowledge.json` のJSON形式が正しいか確認してください。

## 今後の拡張案

- [ ] ベクトルデータベース（Pinecone, Weaviate等）との統合
- [ ] ユーザー認証・権限管理
- [ ] チャット履歴の永続化
- [ ] 多言語対応
- [ ] PDFやWebページからの自動ナレッジ抽出
- [ ] 音声入力・音声読み上げ機能
- [ ] スマートフォンアプリ版

## ライセンス

MIT License

## サポート

問題が発生した場合は、GitHubのIssuesでお知らせください。
